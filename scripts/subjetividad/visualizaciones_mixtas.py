"""
Visualizaciones para An√°lisis de Opiniones Mixtas
===============================================

Este m√≥dulo contiene visualizaciones espec√≠ficas para el an√°lisis de opiniones mixtas.

Autor: Sistema de An√°lisis de Opiniones Tur√≠sticas
Fecha: 2025
"""

import pandas as pd
import matplotlib.pyplot as plt
from typing import Dict, Optional

def visualizar_distribucion_tipos(df: pd.DataFrame, titulo: str = "Distribuci√≥n de Tipos de Opiniones") -> None:
    """
    Visualiza la distribuci√≥n de tipos de opiniones (Subjetivo, Objetivo, Mixto).
    
    Args:
        df: DataFrame con columna 'TipoOpinion'
        titulo: T√≠tulo para los gr√°ficos
    """
    tipos_conteo = df['TipoOpinion'].value_counts()
    tipos_porcentaje = (tipos_conteo / len(df) * 100).round(1)
    
    plt.figure(figsize=(12, 5))
    colores = ['#ff6b6b', '#4ecdc4', '#45b7d1']
    
    # Gr√°fico de conteos
    plt.subplot(1, 2, 1)
    bars = plt.bar(tipos_conteo.index, tipos_conteo.values, color=colores[:len(tipos_conteo)])
    plt.title(f'{titulo}\n(Conteos)', fontsize=12, fontweight='bold')
    plt.ylabel('N√∫mero de Opiniones')
    plt.xticks(rotation=0)
    
    for bar in bars:
        height = bar.get_height()
        plt.text(bar.get_x() + bar.get_width()/2., height + 0.5,
                f'{int(height)}', ha='center', va='bottom', fontweight='bold')
    
    # Gr√°fico de porcentajes
    plt.subplot(1, 2, 2)
    bars2 = plt.bar(tipos_porcentaje.index, tipos_porcentaje.values, color=colores[:len(tipos_porcentaje)])
    plt.title(f'{titulo}\n(Porcentajes)', fontsize=12, fontweight='bold')
    plt.ylabel('Porcentaje (%)')
    plt.xticks(rotation=0)
    
    for bar in bars2:
        height = bar.get_height()
        plt.text(bar.get_x() + bar.get_width()/2., height + 0.2,
                f'{height:.1f}%', ha='center', va='bottom', fontweight='bold')
    
    plt.tight_layout()
    plt.show()

def mostrar_resumen_ejecutivo(estadisticas: Dict) -> None:
    """
    Muestra un resumen ejecutivo de los resultados del an√°lisis.
    
    Args:
        estadisticas: Estad√≠sticas del an√°lisis de opiniones mixtas
    """
    print("üéØ RESUMEN EJECUTIVO - AN√ÅLISIS DE OPINIONES MIXTAS")
    print("=" * 60)
    
    # Resultados principales
    total = estadisticas['total_opiniones']
    mixtas = estadisticas['opiniones_mixtas']
    porcentaje_mixtas = estadisticas['porcentaje_mixtas']
    
    print(f"üìä RESULTADOS PRINCIPALES:")
    print(f"‚Ä¢ Total opiniones analizadas: {total}")
    print(f"‚Ä¢ Opiniones mixtas identificadas: {mixtas} ({porcentaje_mixtas:.1f}%)")
    
    # Distribuci√≥n por tipos
    print(f"\nüìã DISTRIBUCI√ìN POR TIPOS:")
    for tipo, cantidad in estadisticas['distribucion_tipos'].items():
        porcentaje = estadisticas['porcentajes_tipos'][tipo]
        print(f"‚Ä¢ {tipo}: {cantidad} ({porcentaje}%)")
    
    # An√°lisis de frases
    print(f"\nüîç AN√ÅLISIS GRANULAR:")
    print(f"‚Ä¢ Total frases analizadas: {estadisticas['total_frases']}")
    print(f"‚Ä¢ Promedio frases por opini√≥n: {estadisticas['promedio_frases_por_opinion']:.1f}")
    print(f"‚Ä¢ Distribuci√≥n: {estadisticas['porcentaje_frases_subjetivas']:.1f}% subjetivas, {estadisticas['porcentaje_frases_objetivas']:.1f}% objetivas")
    
    # Implicaciones
    print(f"\nüí° IMPLICACIONES PARA TURISTOLOG√çA:")
    if porcentaje_mixtas > 15:
        print(f"‚Ä¢ Las opiniones mixtas representan una fuente significativa de informaci√≥n")
        print(f"‚Ä¢ Combinan percepciones emocionales con datos pr√°cticos √∫tiles")
        print(f"‚Ä¢ Metodolog√≠a validada para extracci√≥n de contenido h√≠brido")
    elif porcentaje_mixtas > 5:
        print(f"‚Ä¢ Evidencia parcial de opiniones mixtas en el dataset")
        print(f"‚Ä¢ Oportunidad para an√°lisis granular en casos espec√≠ficos")
    else:
        print(f"‚Ä¢ Las opiniones tienden a ser predominantemente de un solo tipo")
        print(f"‚Ä¢ Contenido menos mixto de lo esperado")
    
    print(f"\n‚úÖ Metodolog√≠a aplicada exitosamente: Segmentaci√≥n + Clasificaci√≥n por frases")

def mostrar_conclusiones_hipotesis(validacion: Dict, estadisticas: Dict) -> None:
    """
    Muestra las conclusiones finales sobre la validaci√≥n de hip√≥tesis.
    
    Args:
        validacion: Resultados de validaci√≥n de hip√≥tesis
        estadisticas: Estad√≠sticas del an√°lisis
    """
    print(f"\nüî¨ CONCLUSIONES SOBRE LA HIP√ìTESIS")
    print("=" * 50)
    
    print(validacion['mensaje_resultado'])
    
    if validacion['hipotesis_confirmada']:
        print(f"\n‚úÖ EVIDENCIA ENCONTRADA:")
        print(f"‚Ä¢ {validacion['porcentaje_mixtas']:.1f}% de opiniones contienen contenido mixto")
        print(f"‚Ä¢ Las opiniones mixtas combinan informaci√≥n emocional y factual")
        print(f"‚Ä¢ El an√°lisis granular revela contenido h√≠brido no detectado previamente")
        
        if 'mixtas_promedio_subjetivo' in estadisticas:
            print(f"‚Ä¢ Composici√≥n promedio: {estadisticas['mixtas_promedio_subjetivo']:.1f}% subjetivo, {estadisticas['mixtas_promedio_objetivo']:.1f}% objetivo")
    
    elif validacion['evidencia_significativa']:
        print(f"\n‚ö†Ô∏è EVIDENCIA PARCIAL:")
        print(f"‚Ä¢ Se identificaron {estadisticas['opiniones_mixtas']} opiniones mixtas")
        print(f"‚Ä¢ Aunque no alcanza el umbral establecido, es una proporci√≥n relevante")
        print(f"‚Ä¢ Sugiere la existencia de contenido h√≠brido en ciertos contextos")
    
    else:
        print(f"\n‚ùå EVIDENCIA LIMITADA:")
        print(f"‚Ä¢ Solo {validacion['porcentaje_mixtas']:.1f}% de opiniones son mixtas")
        print(f"‚Ä¢ Las opiniones tienden a ser predominantemente de un tipo")
        print(f"‚Ä¢ Menor contenido h√≠brido del esperado en este dataset")
    
    print(f"\nüéØ METODOLOG√çA VALIDADA:")
    print(f"‚Ä¢ Segmentaci√≥n autom√°tica de oraciones con modelos de deep learning")
    print(f"‚Ä¢ Clasificaci√≥n individual de frases para an√°lisis granular")
    print(f"‚Ä¢ Identificaci√≥n exitosa de patrones de contenido h√≠brido")
    print(f"‚Ä¢ Herramienta √∫til para an√°lisis detallado de opiniones tur√≠sticas")
