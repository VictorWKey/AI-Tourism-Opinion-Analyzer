"""
M√≥dulo para an    # Filtrar errores para el an√°lisis
    df_clean = df_clasificado[df_clasificado    estadisticas = {
        'total_reviews': len(df_clean),
        'conteo_general': df_clean['SubjetividadConLLM'].value_counts().to_dict(),
        'porcentaje_general': (df_clean['SubjetividadConLLM'].value_counts(normalize=True) * 100).to_dict(),
        'categoria_predominante': df_clean['SubjetividadConLLM'].value_counts().index[0],
        'conteo_por_ciudad': {}
    }
    
    # Estad√≠sticas por ciudad
    for ciudad in df_clean['Ciudad'].unique():
        df_ciudad = df_clean[df_clean['Ciudad'] == ciudad]
        estadisticas['conteo_por_ciudad'][ciudad] = {
            'total': len(df_ciudad),
            'conteo': df_ciudad['SubjetividadConLLM'].value_counts().to_dict(),
            'categoria_predominante': df_ciudad['SubjetividadConLLM'].value_counts().index[0]
        }nLLM'] != 'Error'].copy()
    
    if len(df_clean) == 0:
        return None
    
    print(f"\nüìä An√°lisis de {len(df_clean)} rese√±as clasificadas")
    
    # Conteo general de clasificaciones
    conteo_general = df_clean['SubjetividadConLLM'].value_counts()ad√≠stico de resultados de clasificaci√≥n.
"""


def analizar_resultados(df_clasificado):
    """
    Analiza los resultados de la clasificaci√≥n y genera estad√≠sticas.
    
    Args:
        df_clasificado (pandas.DataFrame): DataFrame con las clasificaciones
        
    Returns:
        pandas.DataFrame: DataFrame limpio sin errores para an√°lisis adicional
    """
    if df_clasificado is None:
        return None
    
    # Filtrar errores para el an√°lisis
    df_clean = df_clasificado[df_clasificado['SubjetividadConLLM'] != 'Error'].copy()
    
    if len(df_clean) == 0:
        return None
    
    print(f"\nÔøΩ An√°lisis de {len(df_clean)} rese√±as clasificadas")
    
    # Conteo general de clasificaciones
    conteo_general = df_clean['SubjetividadConLLM'].value_counts()
    
    print("\nüè∑Ô∏è DISTRIBUCI√ìN GENERAL:")
    for categoria in ['Objetiva', 'Subjetiva', 'Mixta']:
        if categoria in conteo_general:
            count = conteo_general[categoria]
            pct = (count / len(df_clean)) * 100
            print(f"   {categoria}: {count} rese√±as ({pct:.1f}%)")
    
    # An√°lisis por ciudad
    print("\nüåé POR CIUDAD:")
    for ciudad in df_clean['Ciudad'].unique():
        df_ciudad = df_clean[df_clean['Ciudad'] == ciudad]
        conteo_ciudad = df_ciudad['SubjetividadConLLM'].value_counts()
        
        print(f"\n  üìç {ciudad}:")
        for categoria in ['Objetiva', 'Subjetiva', 'Mixta']:
            if categoria in conteo_ciudad:
                count = conteo_ciudad[categoria]
                pct = (count / len(df_ciudad)) * 100
                print(f"     {categoria}: {count} rese√±as ({pct:.1f}%)")
    
    return df_clean


def mostrar_opiniones_por_categoria(df_clasificado):
    """
    Muestra las opiniones clasificadas por cada categor√≠a para revisi√≥n manual.
    
    Args:
        df_clasificado (pandas.DataFrame): DataFrame con las clasificaciones
    """
    if df_clasificado is None or 'SubjetividadConLLM' not in df_clasificado.columns:
        return

    print("\nüìã Ejemplos por categor√≠a:")
    print("=" * 30)

    categorias = ['Objetiva', 'Subjetiva', 'Mixta']
    for categoria in categorias:
        print(f"\nüè∑Ô∏è {categoria}:")
        opiniones = df_clasificado[df_clasificado['SubjetividadConLLM'] == categoria]['TituloReview']
        if opiniones.empty:
            print("   (No hay opiniones en esta categor√≠a)")
        else:
            # Mostrar solo las primeras 3 para evitar spam
            for idx, opinion in enumerate(opiniones.head(3), start=1):
                print(f"   {idx}. {opinion}")
            if len(opiniones) > 3:
                print(f"   ... y {len(opiniones) - 3} m√°s")


def obtener_estadisticas_resumidas(df_clean):
    """
    Obtiene estad√≠sticas resumidas de los resultados de clasificaci√≥n.
    
    Args:
        df_clean (pandas.DataFrame): DataFrame limpio con clasificaciones
        
    Returns:
        dict: Diccionario con estad√≠sticas resumidas
    """
    if df_clean is None or len(df_clean) == 0:
        return None
    
    estadisticas = {
        'total_reviews': len(df_clean),
        'conteo_general': df_clean['SubjetividadConLLM'].value_counts().to_dict(),
        'porcentaje_general': (df_clean['SubjetividadConLLM'].value_counts(normalize=True) * 100).to_dict(),
        'categoria_predominante': df_clean['SubjetividadConLLM'].value_counts().index[0],
        'conteo_por_ciudad': {}
    }
    
    # Estad√≠sticas por ciudad
    for ciudad in df_clean['Ciudad'].unique():
        df_ciudad = df_clean[df_clean['Ciudad'] == ciudad]
        estadisticas['conteo_por_ciudad'][ciudad] = {
            'total': len(df_ciudad),
            'conteo': df_ciudad['SubjetividadConLLM'].value_counts().to_dict(),
            'categoria_predominante': df_ciudad['SubjetividadConLLM'].value_counts().index[0]
        }
    
    return estadisticas
